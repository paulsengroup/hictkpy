# Copyright (C) 2023 Roberto Rossini <roberros@uio.no>
#
# SPDX-License-Identifier: MIT

include(FetchContent)

FetchContent_Declare(
  FastFloat
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/fast_float-v5.2.0.tar.xz
  URL_HASH SHA256=4c46c081d2098d1d39f70a003e0ada92959b305c121addab60a92de1cfffaae2
  EXCLUDE_FROM_ALL SYSTEM FIND_PACKAGE_ARGS)

FetchContent_Declare(
  fmt
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/fmt-v10.0.0.tar.xz
  URL_HASH SHA256=8570604ab8bc1c4cf70c3eecd278c88be3acf941373374c4908ddf9e7ae84288
  EXCLUDE_FROM_ALL
  SYSTEM
  FIND_PACKAGE_ARGS
  NAMES
  FMT)

FetchContent_Declare(
  HDF5
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/hdf5-v1.14.1.tar.xz
  URL_HASH SHA256=61af1d1412160d2369c44b0ef7a5e92269f596de03d1c47f6d2680af29b0bbd6
  EXCLUDE_FROM_ALL SYSTEM FIND_PACKAGE_ARGS)

FetchContent_Declare(
  HighFive
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/highfive-v2.7.1.tar.xz
  URL_HASH SHA256=951596d3e85bbc8c6ea00cd73ee76e2af203dd29febdce827016378d2f0925e8
  EXCLUDE_FROM_ALL SYSTEM FIND_PACKAGE_ARGS)

FetchContent_Declare(
  libdeflate
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/libdeflate-v1.18.tar.xz
  URL_HASH SHA256=f1e1e2432f9329a5f53939527afb46c417c843520bd526be7f777ab270eb65a0
  EXCLUDE_FROM_ALL SYSTEM FIND_PACKAGE_ARGS)

FetchContent_Declare(
  phmap
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/parallel-hashmap-v1.3.11.tar.xz
  URL_HASH SHA256=f8f672e9fefdaa5fba555a77ff1037d9003401344dd651e71c98212e3eaad8cc
  EXCLUDE_FROM_ALL SYSTEM FIND_PACKAGE_ARGS)

FetchContent_Declare(
  spdlog
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/spdlog-v1.12.0.tar.xz
  URL_HASH SHA256=a37bb250032861c468716861f76aa97192a31107308aea8bf21cb0ad23e8693a
  EXCLUDE_FROM_ALL SYSTEM FIND_PACKAGE_ARGS)

FetchContent_Declare(
  zlib
  URL ${CMAKE_CURRENT_SOURCE_DIR}/external/zlib-v1.2.13.tar.xz
  URL_HASH SHA256=da09190636bdd21d1fbe90edb78c7ede68fdac4db7549f8d4521667d552db262
  EXCLUDE_FROM_ALL
  SYSTEM
  FIND_PACKAGE_ARGS
  NAMES
  ZLIB)

# Setup libdeflate
set(LIBDEFLATE_BUILD_SHARED_LIB ${BUILD_SHARED_LIBS})
set(LIBDEFLATE_BUILD_STATIC_LIB NOT ${BUILD_SHARED_LIBS})
set(LIBDEFLATE_COMPRESSION_SUPPORT OFF)
set(LIBDEFLATE_BUILD_GZIP OFF)

# Setup HDF5
set(BUILD_STATIC_LIBS NOT ${BUILD_SHARED_LIBS})
set(ONLY_SHARED_LIBS ${BUILD_SHARED_LIBS})
set(HDF5_ENABLE_THREADSAFE OFF)
set(BUILD_TESTING OFF)
set(HDF5_BUILD_TOOLS OFF)
set(HDF5_BUILD_EXAMPLES OFF)
set(HDF5_BUILD_HL_LIB OFF)
set(HDF5_BUILD_FORTRAN OFF)
set(HDF5_BUILD_CPP_LIB OFF)
set(HDF5_ENABLE_Z_LIB_SUPPORT ON)

# Setup HighFive
set(HIGHFIVE_PARALLEL_HDF5 OFF)
set(HIGHFIVE_USE_BOOST OFF)
set(HIGHFIVE_USE_EIGEN OFF)
set(HIGHFIVE_USE_XTENSOR OFF)
set(HIGHFIVE_USE_OPENCV OFF)
set(HIGHFIVE_EXAMPLES OFF)
set(HIGHFIVE_UNIT_TESTS OFF)
set(HIGHFIVE_BUILD_DOCS OFF)
set(HIGHFIVE_USE_INSTALL_DEPS OFF)

# Setup phmap
set(PHMAP_INSTALL ON)

find_package(ZLIB REQUIRED)

FetchContent_MakeAvailable(
  FastFloat
  fmt
  HDF5
  HighFive
  libdeflate
  phmap
  spdlog
  zlib)
